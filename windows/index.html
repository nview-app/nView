<!doctype html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="Content-Security-Policy"
      content="default-src 'self';
               img-src 'self' appfile: appblob: data: blob:;
               connect-src 'self' appblob:;
               script-src 'self';
               style-src 'self' 'unsafe-inline';">
    <link rel="icon" type="image/x-icon" href="../favicon.ico" />
    <link rel="stylesheet" href="./shared.css" />
    <title>Gallery</title>
  </head>
  <body class="gallery-page">
    <div id="top">
      <div id="row">
        <button id="openBrowser" class="icon-btn" aria-label="Open Web Viewer" title="Open Web Viewer" disabled>
          <span class="icon icon-global" aria-hidden="true"></span>
        </button>
        <button id="openDownloader" class="icon-btn" aria-label="Open Downloader" title="Open Downloader">
          <span class="icon icon-download" aria-hidden="true"></span>
          <span id="openDownloaderCount" aria-hidden="true">0</span>
        </button>
        <button id="openSettings" class="icon-btn" aria-label="Settings" title="Settings">
          <span class="icon icon-settings" aria-hidden="true"></span>
        </button>
        <input id="searchInput" type="search" placeholder="Search titles, artists, tags" />
        <button id="tagFilterBtn" class="filter-button" type="button" aria-label="Filter tags">
          <span id="tagFilterLabel">Filter tags</span>
          <span id="tagFilterClearBtn" role="button" aria-label="Clear tag filters" title="Clear tag filters">✕</span>
        </button>
        <select id="languageFilterSelect" aria-label="Filter languages">
          <option value="">All languages</option>
        </select>
        <select id="sortSelect" aria-label="Sort library">
          <option value="favorites">Sort: Favorites</option>
          <option value="recent">Sort: Recently added</option>
          <option value="oldest">Sort: Oldest</option>
          <option value="title-asc">Sort: Title A → Z</option>
          <option value="title-desc">Sort: Title Z → A</option>
          <option value="artist-asc">Sort: Artist A → Z</option>
          <option value="pages-desc">Sort: Pages high → low</option>
          <option value="pages-asc">Sort: Pages low → high</option>
        </select>
        <button id="refresh" class="icon-btn" aria-label="Refresh Library" title="Refresh Library">
          <span class="icon icon-refresh" aria-hidden="true"></span>
        </button>
      </div>
    </div>

    <div id="gallery"></div>

    <!-- Vault modal -->
    <div id="vaultModal" role="dialog" aria-modal="true" aria-labelledby="vaultHeader">
      <div class="vaultScreen">
        <div id="vaultPanel">
          <div id="vaultHeader">
            <img id="vaultLogo" src="../logo/logo-full.png" alt="nView" />
          </div>
          <div id="vaultBody">
            <div id="vaultMessage">Enter your vault passphrase to unlock the library.</div>
            <input id="vaultPassphrase" class="vaultInput" type="password" placeholder="Passphrase" />
            <div id="vaultStrength" aria-live="polite">
              <div id="vaultStrengthBar" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0"></div>
            </div>
            <div id="vaultStrengthLabel"></div>
            <input
              id="vaultPassphraseConfirm"
              class="vaultInput"
              type="password"
              placeholder="Confirm passphrase"
            />
            <div id="vaultPassphraseHelp">
              Use a minimum of 10 characters. It is recommended to include at least one uppercase letter, one lowercase letter, one digit, and one symbol.
            </div>
            <div id="vaultError"></div>
            <div id="vaultActions">
              <button id="vaultInit" class="button-with-icon">
                <span class="icon icon-lock" aria-hidden="true"></span>
                Enable encryption
              </button>
              <button id="vaultUnlock" class="button-with-icon">
                <span class="icon icon-unlock" aria-hidden="true"></span>
                Decrypt
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Tag filter modal -->
    <div id="tagModal" role="dialog" aria-modal="true" aria-labelledby="tagModalTitle">
      <div id="tagPanel">
        <div id="tagHeader">
          <div id="tagModalTitle">Filter tags</div>
          <button id="closeTagModal" class="modal-close-btn" type="button" aria-label="Close">✕</button>
        </div>
        <div id="tagBody">
          <input id="tagSearchInput" type="search" placeholder="Search tags" />
          <div class="tagToggleRow">
            <div id="tagModeLabel">Match any selected tags</div>
            <label class="tagToggle">
              <input id="tagMatchAllToggle" type="checkbox" />
              <span>Match all</span>
            </label>
          </div>
          <div id="tagList" class="tagList"></div>
          <div id="tagActions">
            <button id="clearTagFilters" type="button">Clear</button>
            <div id="tagSelectionSummary">No tags selected</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Reader modal -->
    <div id="reader">
      <div id="readerPanel">
        <div id="readerTop">
          <button id="favoriteToggle" class="icon-btn" aria-label="Toggle favorite" title="Toggle favorite">
            <span class="icon icon-star" aria-hidden="true"></span>
          </button>
          <div id="readerTitle">Reader</div>
          <label class="readerJump" for="readerPageSelect">
            <select id="readerPageSelect" aria-label="Jump to page"></select>
          </label>
          <button id="editComic" class="button-with-icon">
            <span class="icon icon-edit" aria-hidden="true"></span>
            Edit
          </button>
          <button id="closeReader" class="modal-close-btn" aria-label="Close">✕</button>
        </div>
        <div id="pages"></div>
      </div>
    </div>

    <!-- Settings modal -->
    <div id="settingsModal" role="dialog" aria-modal="true" aria-labelledby="settingsTitle">
      <div id="settingsPanel">
        <div id="settingsHeader">
          <div id="settingsTitle">Settings</div>
          <button id="closeSettings" class="modal-close-btn" aria-label="Close">✕</button>
        </div>
        <div id="settingsBody">
          <label class="settingsField" for="settingsStartPage">
            <span>Application URL</span>
            <div class="settingsInputWrapper">
              <input id="settingsStartPage" type="text" placeholder="https://example.com" />
              <span id="settingsStartPageStatus" class="settingsValidationIcon" aria-hidden="true"></span>
            </div>
            <span class="settingsHelp">Used as homepage and script hooks.</span>
          </label>
          <label class="settingsField" for="settingsDefaultSort">
            <span>Default sort</span>
            <select id="settingsDefaultSort">
              <option value="favorites">Sort: Favorites</option>
              <option value="recent">Sort: Recently added</option>
              <option value="oldest">Sort: Oldest</option>
              <option value="title-asc">Sort: Title A → Z</option>
              <option value="title-desc">Sort: Title Z → A</option>
              <option value="pages-desc">Sort: Pages high → low</option>
              <option value="pages-asc">Sort: Pages low → high</option>
            </select>
            <span class="settingsHelp">Applied when the gallery opens.</span>
          </label>
          <label class="settingsField" for="settingsCardSize">
            <span>Manga card size</span>
            <select id="settingsCardSize">
              <option value="small">Small</option>
              <option value="normal">Normal</option>
              <option value="large">Large</option>
            </select>
            <span class="settingsHelp">Changes the width of manga cards in the grid.</span>
          </label>
          <label class="settingsField settingsToggle" for="settingsDarkMode">
            <input id="settingsDarkMode" type="checkbox" />
            <span class="settingsToggleTitle">Dark mode</span>
            <span class="settingsHelp">Applies dark styling across the gallery.</span>
          </label>
          <label class="settingsField settingsToggle" for="settingsBlockPopups">
            <input id="settingsBlockPopups" type="checkbox" />
            <span class="settingsToggleTitle">Block pop-up windows</span>
            <span class="settingsHelp">Stops sites in Web Viewer from opening extra windows.</span>
          </label>
          <label class="settingsField settingsToggle" for="settingsAllowListEnabled">
            <input id="settingsAllowListEnabled" type="checkbox" />
            <span class="settingsToggleTitle">Enable allow list</span>
            <span class="settingsHelp">
              Restricts Web Viewer to the Application URL and the domains listed below.
            </span>
          </label>
          <label class="settingsField" for="settingsAllowListDomains">
            <span>Allowed domains</span>
            <textarea
              id="settingsAllowListDomains"
              rows="4"
              placeholder="*.cloudflare.com"
            ></textarea>
            <span class="settingsHelp">One domain per line. Wildcards like *.example.com are supported.</span>
          </label>
          <div class="settingsDivider"></div>

          <div class="settingsInfo">
            <div class="settingsInfoTitle">Viewer instructions</div>
            <div class="settingsInfoText">
              Press “f” to toggle between full size and full page view.<br />
              Press “space” to jump to the next page.
            </div>
          </div>
          <div class="settingsInfo">
            <div class="settingsInfoTitle">About library</div>
            <div id="status" class="settingsInfoText">Loading library details...</div>
            <div class="settingsInlineActions">
              <button id="openMoveLibraryModal" class="button-with-icon" type="button">
                <span class="icon icon-open-folder" aria-hidden="true"></span>
                Move library directory
              </button>
            </div>
            <div class="settingsHelp">
              Move the full library to a new directory.
            </div>
          </div>
        </div>
        <div id="settingsActions">
          <button id="saveSettings" class="button-with-icon save-btn">
            <span class="icon icon-save-heart" aria-hidden="true"></span>
            Save
          </button>
        </div>
      </div>
    </div>

    <div id="moveLibraryModal" role="dialog" aria-modal="true" aria-labelledby="moveLibraryTitle">
      <div id="moveLibraryPanel">
        <div id="moveLibraryHeader">
          <div id="moveLibraryTitle">Move library directory</div>
          <button id="closeMoveLibraryModal" class="modal-close-btn" aria-label="Close">✕</button>
        </div>
        <div id="moveLibraryBody">
          <div class="settingsHelp">
            This will move your encrypted library to a new location. This may take some time depending on size.
          </div>
          <div class="moveLibrarySection">
            <label class="settingsField" for="moveLibraryCurrentPath">
              <span>Current location</span>
              <input id="moveLibraryCurrentPath" type="text" disabled />
            </label>
            <div id="moveLibraryCurrentSize" class="settingsHelp">Size: -</div>
          </div>

          <div class="moveLibrarySection">
            <div class="moveLibraryChooseRow">
              <button id="selectMoveLibraryPath" class="button-with-icon" type="button">
                <span class="icon icon-open-folder" aria-hidden="true"></span>
                Select new location
              </button>
              <input id="moveLibrarySelectedPath" type="text" disabled placeholder="No folder selected" />
            </div>
          </div>

          <table class="moveLibraryChecks" aria-live="polite">
            <thead>
              <tr>
                <th scope="col">Check</th>
                <th scope="col">Status</th>
                <th scope="col">Details</th>
              </tr>
            </thead>
            <tbody>
              <tr id="moveLibraryPermissionCheck" class="moveLibraryCheck"></tr>
              <tr id="moveLibraryEmptyCheck" class="moveLibraryCheck"></tr>
              <tr id="moveLibrarySpaceCheck" class="moveLibraryCheck"></tr>
            </tbody>
          </table>

          <div id="moveLibraryError" class="settingsHelp"></div>

          <div id="moveLibraryProgressWrap" aria-live="polite">
            <div id="moveLibraryProgressLabel">Ready to move.</div>
            <div id="moveLibraryProgressTrack">
              <div id="moveLibraryProgressBar"></div>
            </div>
          </div>
        </div>
        <div id="moveLibraryActions">
          <button id="cancelMoveLibrary" type="button">Cancel</button>
          <button id="confirmMoveLibrary" class="button-with-icon save-btn" type="button" disabled>
            <span class="icon icon-open-folder" aria-hidden="true"></span>
            Move
          </button>
        </div>
      </div>
    </div>

    <!-- Edit metadata modal -->
    <div id="editModal" role="dialog" aria-modal="true" aria-labelledby="editTitle">
      <div id="editPanel">
        <div id="editHeader">
          <div id="editTitle">Edit metadata</div>
          <button id="closeEdit" class="modal-close-btn" aria-label="Close">✕</button>
        </div>
        <div id="editBody">
          <label class="editField" for="editTitleInput">
            <span>Title</span>
            <input id="editTitleInput" type="text" placeholder="Comic title" />
          </label>
          <label class="editField" for="editAuthorInput">
            <span>Author</span>
            <input id="editAuthorInput" type="text" placeholder="Artist/author name" />
          </label>
          <label class="editField" for="editLanguagesInput">
            <span>Languages</span>
            <input id="editLanguagesInput" type="text" placeholder="English, Japanese" />
            <span class="editHelp">Separate languages with commas.</span>
          </label>
          <label class="editField" for="editTagsInput">
            <span>Tags</span>
            <textarea id="editTagsInput" rows="3" placeholder="comma, separated, tags"></textarea>
            <span class="editHelp">Separate tags with commas.</span>
          </label>
        </div>
        <div id="editActions">
          <button id="openFolder" class="button-with-icon edit-secondary">
            <span class="icon icon-open-folder" aria-hidden="true"></span>
            Show in folder
          </button>
          <button id="deleteComic" class="button-with-icon danger">
            <span class="icon icon-delete" aria-hidden="true"></span>
            Delete
          </button>
          <button id="saveEdit" class="button-with-icon save-btn">
            <span class="icon icon-save-heart" aria-hidden="true"></span>
            Save
          </button>
        </div>
      </div>
    </div>

    <script src="../renderer/renderer.js"></script>
  </body>
</html>
